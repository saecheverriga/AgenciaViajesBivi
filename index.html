// --- COMPONENTE DE CARRUSEL 3D REUTILIZABLE ---
        const Carousel3D = ({ id, folder, filePrefix, badge, title, subtitleStart, linkText, subtitleEnd, backgroundStyle, scrollToSection }) => {
            const [angle, setAngle] = useState(0);
            const [lightboxSrc, setLightboxSrc] = useState(null);
            const [images, setImages] = useState([]); 
            const [radius, setRadius] = useState(400); // Valor inicial seguro

            useEffect(() => {
                const checkImages = async () => {
                    const foundImages = [];
                    let i = 1;
                    let keepChecking = true;
                    
                    const loadImage = (url) => {
                        return new Promise((resolve, reject) => {
                            const img = new Image();
                            img.onload = () => resolve(url);
                            img.onerror = () => reject(url);
                            img.src = url;
                        });
                    };

                    while (keepChecking && i <= 50) {
                        const path = `./${folder}/${filePrefix}${i}.jpg`;
                        try {
                            await loadImage(path);
                            foundImages.push(path);
                            i++;
                        } catch (error) {
                            keepChecking = false; 
                        }
                    }
                    
                    // FALLBACKS (Solo para demo si no hay fotos reales)
                    if (foundImages.length === 0) {
                        const fallbackBase = folder === 'viajes' 
                            ? "https://images.unsplash.com/photo-1596436889106-be35e843f974?auto=format&fit=crop&q=80&w=600" // Colombia fallback
                            : "https://images.unsplash.com/photo-1502602898657-3e91760cbb34?auto=format&fit=crop&q=80&w=600"; // Paris/Intl fallback
                        
                        foundImages.push(fallbackBase, fallbackBase, fallbackBase, fallbackBase, fallbackBase);
                    }
                    
                    setImages(foundImages);
                };

                checkImages();
            }, [folder, filePrefix]);

            const slideCount = images.length;
            const theta = slideCount > 0 ? 360 / slideCount : 0;

            const rotate = (dir) => {
                setAngle(prevAngle => prevAngle + (dir * theta));
            };

            // L√ìGICA DE RADIO INTELIGENTE
            // Se actualiza cuando cambia el tama√±o de pantalla O el n√∫mero de im√°genes
            useEffect(() => {
                const calculateRadius = () => {
                    // 1. Radio base seg√∫n el ancho de pantalla (para que se vea grande en PC)
                    let baseRadius = window.innerWidth / 2;

                    // 2. Radio m√≠nimo necesario por cantidad de fotos (Anti-solapamiento)
                    // Per√≠metro necesario ~= AnchoSlide (300px) * NumeroFotos
                    // Radio necesario ~= Per√≠metro / (2 * PI)
                    // A√±adimos un factor de holgura (1.1)
                    if (slideCount > 0) {
                        const minRadiusForImages = (slideCount * 300) / (2 * Math.PI) * 1.1;
                        // El radio nunca ser√° menor a 340px (para m√≥viles) ni menor a lo necesario por las fotos
                        baseRadius = Math.max(baseRadius, minRadiusForImages, 340);
                    } else {
                        baseRadius = Math.max(baseRadius, 340);
                    }

                    setRadius(baseRadius);
                };

                calculateRadius();
                window.addEventListener('resize', calculateRadius);
                return () => window.removeEventListener('resize', calculateRadius);
            }, [slideCount]);

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (lightboxSrc) {
                        if (e.key === 'Escape') setLightboxSrc(null);
                    } 
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [lightboxSrc]); 

            // RENDERIZADO SEGURO: Si no hay im√°genes, retornamos null DESPU√âS de todos los hooks
            if (slideCount === 0) return null;

            return (
                <section id={id} className="carousel-3d-section" style={{ background: backgroundStyle }}>
                    <div className="text-center mb-8 px-6">
                        <div className="inline-block bg-white/10 text-white font-semibold px-4 py-1 rounded-full text-sm mb-3 border border-white/30 backdrop-blur-sm">
                            {badge}
                        </div>
                        <h2 className="text-4xl font-bold text-white mb-4 leading-tight">{title}</h2>
                        <p className="text-gray-200 max-w-2xl mx-auto text-lg">
                            {subtitleStart} <button onClick={() => scrollToSection('contacto')} className="text-cyan-300 font-bold hover:text-white underline decoration-2 underline-offset-4 cursor-pointer bg-transparent border-none p-0 inline transition-colors">{linkText}</button> {subtitleEnd}
                        </p>
                    </div>

                    <div className="carousel-wrapper">
                        <div 
                            className="carousel-3d" 
                            style={{ transform: `translateZ(-${radius}px) rotateY(${angle}deg)` }}
                        >
                            {images.map((src, i) => (
                                <div 
                                    key={i} 
                                    className="slide-3d" 
                                    style={{ transform: `rotateY(${theta * i}deg) translateZ(${radius}px)` }}
                                    onClick={() => setLightboxSrc(src)}
                                >
                                    <img src={src} alt={`Destino ${i + 1}`} loading="lazy" />
                                </div>
                            ))}
                        </div>
                        <div className="controls-3d">
                            <button onClick={() => rotate(1)} aria-label="Anterior">‚Üê</button>
                            <button onClick={() => rotate(-1)} aria-label="Siguiente">‚Üí</button>
                        </div>
                        {/* Indicaci√≥n de interacci√≥n */}
                        <p className="absolute -bottom-[130px] w-full text-center text-cyan-200/80 text-sm font-light tracking-wide pointer-events-none z-10">
                            <span className="inline-block mr-1 text-lg">üëÜ</span> Haz clic en la imagen para ver detalles
                        </p>
                    </div>

                    {lightboxSrc && (
                        <div className="lightbox-overlay" onClick={() => setLightboxSrc(null)}>
                            <span className="close-lightbox" onClick={() => setLightboxSrc(null)}>√ó</span>
                            <img 
                                src={lightboxSrc} 
                                alt="Imagen ampliada" 
                                className="lightbox-image"
                                onClick={(e) => e.stopPropagation()} 
                            />
                        </div>
                    )}
                </section>
            );
        };
